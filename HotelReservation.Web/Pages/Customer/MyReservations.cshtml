@page
@model HotelReservation.Web.Pages.Customer.MyReservationsModel

@{
    ViewData["Title"] = "Rezervasyonlarım";
}

<h1>Rezervasyonlarım</h1>

@if (Model.Reservations == null || !Model.Reservations.Any())
{
    <div class="alert alert-info">
        Henüz hiç rezervasyonunuz bulunmuyor.
    </div>
}
else
{
    <table class="table table-striped table-hover align-middle">
        <thead>
            <tr>
                <th>Otel</th>
                <th>Şehir</th>
                <th>Oda No</th>
                <th>Giriş</th>
                <th>Çıkış</th>
                <th>Kişi</th>
                <th>Toplam Tutar</th>
                <th>Durum</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var r in Model.Reservations)
            {
                var isPast = r.CheckOut.Date < DateTime.Today;
                <tr class="@(isPast ? "table-light" : "")">
                    <td>@r.HotelName</td>
                    <td>@r.City</td>
                    <td>@r.RoomNumber</td>
                    <td>@r.CheckIn.ToShortDateString()</td>
                    <td>@r.CheckOut.ToShortDateString()</td>
                    <td>@r.GuestCount</td>
                    <td>@r.TotalPrice.ToString("C")</td>
                    <td>
                        @switch (r.Status)
                        {
                            case HotelReservation.Core.Enums.ReservationStatus.Pending:
                                @:<span class="badge bg-warning text-dark">Beklemede</span>
                                break;
                            case HotelReservation.Core.Enums.ReservationStatus.Confirmed:
                                @:<span class="badge bg-success">Onaylandı</span>
                                break;
                            case HotelReservation.Core.Enums.ReservationStatus.Cancelled:
                                @:<span class="badge bg-secondary">İptal</span>
                                break;
                            default:
                                @:<span class="badge bg-light text-dark">Bilinmiyor</span>
                                break;
                        }

                        @if (isPast && r.Status == HotelReservation.Core.Enums.ReservationStatus.Confirmed)
                        {
                            @: <span class="badge bg-info ms-1">Tamamlandı</span>
                        }
                    </td>
                    <td>
                        @if (r.Status != HotelReservation.Core.Enums.ReservationStatus.Cancelled && !isPast && r.CheckIn.Date > DateTime.Today)
                        {
                            <a asp-page="/Customer/CancelReservation" asp-route-id="@r.ReservationId" class="btn btn-sm btn-danger">İptal Et</a>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
